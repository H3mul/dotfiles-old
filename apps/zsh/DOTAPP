# should be the same as dir name
appname="zsh"
# Organization and grouping
tags=(cli)
# yay packages required for this app
pkg_depends=(zsh fd fzf)

# plugin installer helper
zsh_plugin () {
    [[ -z $1 ]] && return

    # eg wfxr/forgit
    plugin_path=$1
    plugin=${plugin_path#*\/}
    plugin_home="$zsh_plugin_home/$plugin"

    if [ ! -d  "$plugin_home" ]; then
        sub_msg "installing $plugin for omz..."
        git clone "https://github.com/$plugin_path" "$plugin_home"
    fi
}

# Commands run after package installs
install_post () {
    [ -d "$HOME/.oh-my-zsh" ] && sub_msg "oh-my-zsh already installed, skipping..." && return

    sub_msg "Installing oh-my-zsh..."
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended

    # Hack to get rid of stow conflict
    # rm ~/.zshrc

    sub_msg "Installing oh-my-zsh plugins..."

    zsh_plugin_home=${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/
    zsh_plugin 'wfxr/forgit'
    zsh_plugin 'zsh-users/zsh-syntax-highlighting'
    zsh_plugin 'zsh-users/zsh-autosuggestions'
    zsh_plugin 'Aloxaf/fzf-tab'
    unset zsh_plugin

    sub_msg "Prompting to change your shell to ZSH..."

    sudo chsh -s $(which zsh) $(whoami)
}
